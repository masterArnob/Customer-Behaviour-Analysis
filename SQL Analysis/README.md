# Customer Behavior Analysis SQL Queries

## Database Setup
```sql
USE customer_behaviour_db;
SELECT * FROM customer;
```

## Analysis Questions
### Q1: Product Performance
```sql
-- Q: Product Performance

WITH sales_data AS(
SELECT
	item_purchased AS product_name,
	SUM(purchase_amount) AS current_sales
FROM customer
GROUP BY
	item_purchased
)
SELECT 
	product_name,
	current_sales,
	(SELECT AVG(current_sales) FROM sales_data) AS avarage_sales,
	current_sales - (SELECT AVG(current_sales) FROM sales_data) AS sales_difference,

CASE WHEN current_sales - (SELECT AVG(current_sales) FROM sales_data) > 0 THEN 'Profit'
	 WHEN current_sales - (SELECT AVG(current_sales) FROM sales_data) < 0 THEN 'Loss'
	 ELSE 'Avarage'
END performance

FROM sales_data;
```
![1](/Assets/11.png)
### Q1: What are the total revenue generated by male vs female customers?
```sql
SELECT 
	gender,
	CONCAT('$', SUM(purchase_amount)) AS total_revenue
FROM customer
GROUP BY gender;
```
![1](/Assets/1.png)

### Q2: Which Customers used discount but still spent more than the avarage purchase amount?
```sql
SELECT 
	customer_id,
	CONCAT('$', purchase_amount) AS spent
FROM
	customer
WHERE 
	discount_applied = 'Yes' 
	AND purchase_amount > (SELECT AVG(purchase_amount) FROM customer)
ORDER BY purchase_amount DESC;
```
![2](/Assets/2.png)

### Q3: Whcih are the top 5 products with the highest avarage review rating?
```sql
SELECT TOP 5
	item_purchased,
	AVG(review_rating) AS avg_rating
FROM customer
GROUP BY item_purchased
ORDER BY
	AVG(review_rating) DESC;
```
![3](/Assets/3.png)

### Q4: Compare the avarage purchase amounts between standard and express shippings.
```sql
SELECT
	shipping_type,
	CONCAT('$', AVG(purchase_amount)) AS avg_purchase_amount
FROM customer
WHERE shipping_type IN('Standard', 'Express')
GROUP BY
	shipping_type;
```
![4](/Assets/4.png)

### Q5: Do subscribe customer spand more? 
```sql
SELECT 
	subscription_status,
	CONCAT('$', AVG(purchase_amount)) AS spend,
	CONCAT('$', SUM(purchase_amount)) AS total_revenue
FROM customer
GROUP BY subscription_status;
```

![5](/Assets/5.png)

### Q6: Which product have the highest percentage of the purchases with discount applied?
#### formula: percent = (no. of discount purchases / total purchase) X 100
```sql
SELECT TOP 5
	item_purchased,
	CONCAT((SUM(CASE WHEN discount_applied = 'Yes' THEN 1 ELSE 0 END) * 100 / COUNT(*)), '%') sale_percent
FROM customer
GROUP BY item_purchased
ORDER BY sale_percent DESC;
```

![6](/Assets/6.png)

### Q7: Segment customer into  vip, regular, new based on the total previous purchases show the count segment
```sql
WITH segment AS(
SELECT 
	customer_id,
	previous_purchases,
CASE WHEN previous_purchases >= 10 THEN 'VIP'
     WHEN previous_purchases >= 5 THEN 'Regular'
	 ELSE 'New'
END customer_segment
FROM customer)
SELECT 
	customer_segment,
	COUNT(customer_id) AS total_customer
FROM segment
GROUP BY 
	customer_segment
ORDER BY COUNT(customer_id) DESC;
```
![7](/Assets/7.png)

### Q8: What are the top 3 most purchased product withing each category?
```sql

WITH sales_data AS(
SELECT 
	category,
	item_purchased AS product_name,
	COUNT(item_purchased) AS sale_count
FROM customer
GROUP BY
	item_purchased,
	category
),
product_ranking AS(
SELECT 
	category,
	product_name,
	sale_count,
	ROW_NUMBER() OVER (PARTITION BY category ORDER BY sale_count DESC) AS ranking
FROM sales_data
)
SELECT 
	ranking,
	category,
	product_name,
	sale_count
FROM product_ranking
WHERE
	ranking <= 5
GROUP BY 
	category,
	product_name,
	sale_count,
	ranking;
```
![8](/Assets/8.png)

### Q9: Are customers who have more than 5 previous purchases are likely to subscribe?
```sql
SELECT 
	subscription_status,
	COUNT(customer_id) AS total_customers
FROM customer
WHERE 
	previous_purchases > 5
GROUP BY 
	subscription_status;
```

![9](/Assets/9.png)

### Q10: What is the revenue contribution of each age group?
```sql
SELECT
	age_group,
	CONCAT('$', SUM(purchase_amount)) AS total_revenue
FROM customer
GROUP BY
	age_group
ORDER BY SUM(purchase_amount) DESC
;
```
![10](/Assets/10.png)









